 {% extends "layout.html" %}
{% block title %}Editor{% endblock %}
{% block head %}
	{{ super() }}
{% endblock %}

{% block options %}
	<br>
	<p class="nav-link" data-toggle="modal" data-target="#generateExamsModal" href="">Generar exámenes</p>
{% endblock %}


{% block content %}
	<br><br>
	<center><h1>Editando: {{ evalName }}</h1></center>

	{% set empty = [] %}
	<span id="questionFormat" style="display:none">{{ questionFormat(empty) }}</span>
	<form id="editor" action="submitEval" method="POST">
		<input type="hidden" name="userName" value={{ userName }}>
		<input type="hidden" name="userId" value={{ userId }}>
		<input type="hidden" name="evalName" value={{ evalName }}>
		<input type="hidden" name="evalId" value={{ evalId }}>
		{% if questions|length > 0 %}
			{% for question in questions %}
				{{ questionFormat(question) }}
			{% endfor %}
		{% else %}
			<script>addQuestion();</script>
		{% endif %}
	</form>

	<br>
	<center><button type="button" class="btn btn-success" onclick="addQuestion()">Agregar pregunta</button></center>

	<br>
	<button type="button" class="btn btn-primary" data-dismiss="modal" style="float:right" onclick="save()">Guardar cambios</button>
	<p id="messageError" style="color:red"></p>

	<div class="modal" id="deleteQuestionModal">
		<div class="modal-dialog">
			<div class="modal-content">
			    <!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Eliminar pregunta</h4>
			    	<button type="button" class="close" data-dismiss="modal">&times;</button>
			    </div>
			  	<!-- Modal body -->
			  	<div class="modal-body">
    				<label for="name">¿Desea eliminar la pregunta?</label>
			  	</div>
			  	<!-- Modal footer -->
			  	<div class="modal-footer">
			  		<button type="button" class="btn btn-danger" onclick="confirmDeleteQuestion()" data-dismiss="modal">Eliminar</button>
			    	<button type="button" class="btn btn-primary" data-dismiss="modal">Cancelar</button>
			  	</div>
			  	<input type="hidden" value={{ user }} name="user">
			</div>
		</div>
	</div>

	<div class="modal" id="generateExamsModal">
		<div class="modal-dialog">
			<div class="modal-content">
			    <!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Crear exámenes</h4>
			    	<button type="button" class="close" data-dismiss="modal">&times;</button>
			    </div>
			    <form action="generateExams" method="POST" id="generateExamsForm">
				  	<!-- Modal body -->
				  	<div class="modal-body">
			    		<div class="form-group">
    						<label>Número de reactivos por examen:</label>
    						<input type="number" min="1" class="form-control" name="reactivos">
 						</div>
 						<div class="form-group">
    						<label>Cantidad de exámenes a generar:</label>
    						<input type="number" min="1" class="form-control" name="exams">
 						</div>
 						<p id="generateExamsError" style="color:red"></p>
 						<p id="generateExamsSuccess" style="color:green"></p>
 						<input type="hidden" name="user" value={{ user }}>
 						<input type="hidden" name="evalName" value={{ evalName }}>
				  	</div>
				  	<input type="hidden" value={{ user }} name="user">
				</form>
			  	<!-- Modal footer -->
			  	<div class="modal-footer">
			  		<button type="button" class="btn btn-primary" onclick="generateExams()">Crear</button>
			    	<button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
			  	</div>
			</div>
		</div>
	</div>
{% endblock %}

{% macro questionFormat(question) %}	
	<section class="pregunta">
		<br>
		<table style="width:100%; min-width:500px">
			<tr>
				<td>
					<label style="float:left">Enunciado:</label>
					<button type="button" class="btn btn-basic btn-sm" onclick="deleteQuestion(this.parentElement.parentElement.parentElement.parentElement.parentElement)" style="float:right">Eliminar pregunta</button>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<input type="text" class="form-control question" name="question" onchange="Saved=false" value={{ question.statement }}>
				</td>
			</tr>
			<tr>
				<td>
					<label><input type="checkbox" value="T" name="algebra" onchange="toggleQuestion(this, this.parentElement.parentElement.parentElement.nextElementSibling.nextElementSibling.firstChild, this.parentElement.parentElement.parentElement.nextElementSibling.firstChild)" {% if question.algebraic %} checked {% endif %}>Algebraico?</label>
				</td>
			</tr>
			<tr><td colspan="2" {% if question.algebraic is defined%} style="display:none" {% endif %}><table style="width:100%">
				<tr>
					<td>
						<label class="form-l">Respuesta Correcta:</label>
					</td>
					<td>
						<input type="text" class="form-control answer" name="1" onchange="Saved=false" value={{ question.correct }}>
					</td>
				</tr>
				<tr>
					<td style="vertical-align: top">
						<label class="form-l">Distractores:</label>
					</td>
					<td>
						<input style="margin-bottom:2px" type="text" class="form-control answer" name="2" onchange="Saved=false" value={{ question.distractor1 }}>
						<input style="margin-bottom:2px" type="text" class="form-control answer" name="3" onchange="Saved=false" value={{ question.distractor2 }}>
						<input style="margin-bottom:2px" type="text" class="form-control answer" name="4" onchange="Saved=false" value={{ question.distractor3 }}>
					</td>
				</tr>
			</table></td></tr>
			<tr><td colspan="2" {% if question.algebraic is not defined %} style="display:none" {% endif %}><table style="width:100%">
				<tr>
					<td>
						<label class="form-l">Formula:</label>
					</td>
					<td>
						<input type="text" class="form-control formula" name="5" onchange="Saved=false" value={{ question.formula }}>
					</td>
				</tr>
			</table></td></tr>
		</table>
		<hr style="border-color:#99ccff">
	</section>
{% endmacro %}